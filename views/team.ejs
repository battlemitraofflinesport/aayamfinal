<!-- views/team.ejs -->
<div class="container">
  <div class="page-header" data-aos="fade-down">
    <div class="section-label">Meet The People</div>
    <h1 class="page-title">Our Team</h1>
    <p class="page-subtitle">The dedicated individuals driving AAYAM Committee forward</p>
  </div>

  <% sections.forEach((section, si)=> { %>
    <div class="team-section" data-aos="fade-up" data-aos-delay="<%= si * 60 %>">

      <h2 class="team-section-title">
        <%= section.title %>
      </h2>
      <div class="team-section-underline"></div>

      <% if (user && (user.role==="admin" || user.role==="superadmin" )) { %>
        <div class="text-center mb-4 d-flex gap-2 justify-content-center flex-wrap">
          <a href="/team/section/edit/<%= section.id %>" class="btn-details">✏ Edit Section</a>
          <form action="/team/section/delete/<%= section.id %>" method="POST" class="d-inline"
            onsubmit="return confirm('Delete this section and all its members?')">
            <button class="btn-admin-danger">✕ Delete Section</button>
          </form>
        </div>
        <% } %>

          <div class="row g-3 justify-content-center">
            <% if (section.members && section.members.length> 0) { %>
              <% let renderMembers=section.members; let isOrgTeam=(section.title==='Organizing Team' ); if (isOrgTeam) {
                renderMembers=[...section.members].sort((a, b)=> {
                const posA = a.position || "";
                const posB = b.position || "";
                if (posA === 'PRESIDENT') return -1;
                if (posB === 'PRESIDENT') return 1;
                if (posA === 'VICE PRESIDENT') return -1;
                if (posB === 'VICE PRESIDENT') return 1;
                return 0;
                });
                }
                %>
                <% renderMembers.forEach((member, mi)=> { %>
                  <div
                    class="<%= isOrgTeam ? 'col-12 d-flex justify-content-center' : 'col-xl-2 col-lg-3 col-md-4 col-6' %>"
                    data-aos="zoom-in" data-aos-delay="<%= mi * 55 %>">
                    <div class="team-member-card">
                      <div class="team-member-img-wrap">
                        <img src="<%= member.image %>" alt="<%= member.name %>" class="team-member-img">
                      </div>
                      <p class="team-member-name">
                        <%= member.name %>
                      </p>
                      <% if(member.position) { %>
                        <p class="team-member-position"
                          style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 5px; font-weight: 500;">
                          <%= member.position %>
                        </p>
                        <% } %>
                          <% if (user && (user.role==="admin" || user.role==="superadmin" )) { %>
                            <div class="d-flex gap-2 justify-content-center flex-wrap mt-1">
                              <a href="/team/member/edit/<%= member.id %>" class="btn-details"
                                style="font-size:0.78rem;padding:5px 12px;">✏ Edit</a>
                              <form action="/team/member/delete/<%= member.id %>" method="POST"
                                onsubmit="return confirm('Delete this member?')">
                                <button class="btn-admin-danger" style="font-size:0.78rem;padding:5px 12px;">✕</button>
                              </form>
                            </div>
                            <% } %>
                    </div>
                  </div>
                  <% }) %>
                    <% } else { %>
                      <div class="col-12 text-center" style="color:var(--tx-muted);padding:24px 0;">No members added
                        yet.
                      </div>
                      <% } %>
          </div>

          <% if (user && (user.role==="admin" || user.role==="superadmin" )) { %>
            <div class="mt-4 d-flex justify-content-center">
              <details class="admin-add-form" style="max-width:480px;width:100%;">
                <summary style="cursor:pointer;font-weight:700;color:var(--br);list-style:none;padding:4px 0;">➕ Add
                  Member to this Section</summary>
                <form action="/team/member/add" method="POST" enctype="multipart/form-data" class="mt-3">
                  <input type="hidden" name="sectionId" value="<%= section.id %>">
                  <div class="mb-2 text-start">
                    <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">Member
                      Name</label>
                    <input type="text" name="name" placeholder="Enter member name" class="form-control" required>
                  </div>
                  <div class="mb-2 text-start">
                    <label
                      style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">Position</label>
                    <select name="position" class="form-select" required>
                      <option value="" disabled selected>Select Position</option>
                      <option value="PRESIDENT">PRESIDENT</option>
                      <option value="VICE PRESIDENT">VICE PRESIDENT</option>
                      <option value="VICE HEAD">VICE HEAD</option>
                      <option value="SECRETARY">SECRETARY</option>
                      <option value="VICE SECRETARY">VICE SECRETARY</option>
                    </select>
                  </div>
                  <div class="mb-3 text-start">
                    <label style="font-size: 0.85rem; font-weight: 600; margin-bottom: 4px; display: block;">Member
                      Image</label>
                    <input type="file" name="image" class="form-control" accept="image/*" required>
                  </div>
                  <button type="submit" class="btn-register w-100">⬆ Upload Member</button>
                </form>
              </details>
            </div>
            <% } %>

    </div>
    <% }) %>

      <% if (user && (user.role==="admin" || user.role==="superadmin" )) { %>
        <div class="text-center mt-5 pt-4" style="border-top:1px solid var(--border-l);" data-aos="fade-up">
          <h4 class="events-col-title mb-3">Add New Team Section</h4>
          <form action="/team/section/add" method="POST"
            class="d-inline-flex gap-2 align-items-center justify-content-center flex-wrap">
            <select name="title" class="form-select" style="max-width:280px;" required>
              <option value="" disabled selected>Select Team Section</option>
              <option value="Management Department">Management Department</option>
              <option value="Media Department">Media Department</option>
              <option value="Technical Department">Technical Department</option>
              <option value="Sports Department">Sports Department</option>
              <option value="Cultural Department">Cultural Department</option>
              <option value="Organizing Team">Organizing Team</option>
              <option value="Advisory Department">Advisory Department</option>
              <option value="Discipline Department">Discipline Department</option>
            </select>
            <button type="submit" class="btn-register">➕ Add Section</button>
          </form>
        </div>
        <% } %>
</div>