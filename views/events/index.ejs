<!-- views/events/index.ejs -->
<div class="container">

  <div class="page-header" data-aos="fade-down">
    <div class="section-label">What's Happening</div>
    <h1 class="page-title">Events</h1>
    <p class="page-subtitle">All major events coordinated and supported by AAYAM Committee</p>
  </div>

  <!-- Mobile toggle -->
  <div class="d-lg-none" data-aos="fade-up">
    <div class="events-toggle-bar">
      <button class="evt-tab active" id="showUpcoming">Upcoming</button>
      <button class="evt-tab" id="showPast">Past Events</button>
    </div>
  </div>

  <div class="row g-4 justify-content-center">

    <!-- ‚îÄ‚îÄ UPCOMING EVENTS ‚îÄ‚îÄ -->
    <div class="col-lg-6" id="upcomingSection">
      <div class="d-flex align-items-center justify-content-between mb-4" data-aos="fade-up">
        <h2 class="events-col-title mb-0">Upcoming Events</h2>
      </div>

      <% if (user && (user.role === "admin" || user.role === "superadmin")) { %>
        <details class="admin-add-form mb-4" data-aos="fade-up">
          <summary style="cursor:pointer; font-weight:700; color:var(--br); list-style:none; padding:4px 0;">
            ‚ûï Add Upcoming Event
          </summary>
          <form action="/events/add" method="POST" enctype="multipart/form-data" class="mt-4">
            <input type="hidden" name="type" value="upcoming">
            <input type="text" name="title" placeholder="Event Title" class="form-control mb-2" required>
            <textarea name="shortDescription" placeholder="Short description" class="form-control mb-2" required></textarea>
            <textarea name="description" placeholder="Full description" class="form-control mb-2" required></textarea>
            <textarea name="about" placeholder="About the event" class="form-control mb-2"></textarea>
            <label class="form-label fw-semibold" style="font-size:0.82rem;color:var(--br);">Start Date</label>
            <input type="date" name="startDate" class="form-control mb-2" required>
            <label class="form-label fw-semibold" style="font-size:0.82rem;color:var(--br);">End Date</label>
            <input type="date" name="endDate" class="form-control mb-2" required>
            <input type="file" name="bannerImage" class="form-control mb-2" accept="image/*" required>
            <input type="url" name="registrationLink" placeholder="Registration link (optional)" class="form-control mb-3">
            <button class="btn-register w-100">‚ûï Add Upcoming Event</button>
          </form>
        </details>
      <% } %>

      <% if (upcomingEvents.length === 0) { %>
        <div class="gallery-empty" data-aos="fade-up">
          <div class="gallery-empty-icon">üìÖ</div>
          <p>No upcoming events right now.</p>
        </div>
      <% } %>

      <% upcomingEvents.forEach((event, i) => { %>
        <div class="event-card" data-aos="fade-up" data-aos-delay="<%= i * 70 %>">
          <% if (event.bannerImage) { %>
            <a href="/events/<%= event.id %>" class="event-card-img-wrap" style="display:block;text-decoration:none;">
              <img src="<%= event.bannerImage %>" class="event-card-img" alt="<%= event.title %>">
            </a>
          <% } %>
          <div class="event-card-body">
            <a href="/events/<%= event.id %>" style="text-decoration:none;">
              <h3 class="event-card-title"><%= event.title %></h3>
            </a>
            <p class="event-card-desc"><%= event.shortDescription %></p>
            <% if (event.startDate && event.endDate) { %>
              <div class="event-card-date">
                <i class="bi bi-calendar3"></i>
                <% if (new Date(event.startDate).toDateString() === new Date(event.endDate).toDateString()) { %>
                  <%= new Date(event.startDate).toDateString() %>
                <% } else { %>
                  <%= new Date(event.startDate).toDateString() %> ‚Üí <%= new Date(event.endDate).toDateString() %>
                <% } %>
              </div>
            <% } %>
            <div class="event-card-actions">
              <% if (event.registrationLink) { %>
                <a href="<%= event.registrationLink %>" target="_blank" class="btn-register">
                  <i class="bi bi-pencil-square"></i> Register
                </a>
              <% } %>
              <a href="/events/<%= event.id %>" class="btn-details">
                View Details <i class="bi bi-arrow-right"></i>
              </a>
            </div>
            <% if (user && (user.role === "admin" || user.role === "superadmin")) { %>
              <div class="d-flex gap-2 mt-3 flex-wrap">
                <form action="/events/move-to-past/<%= event.id %>" method="POST" onsubmit="return confirm('Move to past?')">
                  <button class="btn-admin-warn">‚è≥ Move to Past</button>
                </form>
                <form action="/events/delete/<%= event.id %>" method="POST" onsubmit="return confirm('Delete this event?')">
                  <button class="btn-admin-danger">‚úï Delete</button>
                </form>
              </div>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>

    <!-- ‚îÄ‚îÄ PAST EVENTS ‚îÄ‚îÄ -->
    <div class="col-lg-6" id="pastSection">
      <div class="d-flex align-items-center justify-content-between mb-4" data-aos="fade-up">
        <h2 class="events-col-title mb-0">Past Events</h2>
      </div>

      <% if (user && (user.role === "admin" || user.role === "superadmin")) { %>
        <details class="admin-add-form mb-4" data-aos="fade-up">
          <summary style="cursor:pointer; font-weight:700; color:var(--br); list-style:none; padding:4px 0;">
            ‚ûï Add Past Event
          </summary>
          <form action="/events/add" method="POST" enctype="multipart/form-data" class="mt-4">
            <input type="hidden" name="type" value="past">
            <input type="text" name="title" placeholder="Event Title" class="form-control mb-2" required>
            <textarea name="shortDescription" placeholder="Short description" class="form-control mb-2" required></textarea>
            <textarea name="description" placeholder="Full description" class="form-control mb-2" required></textarea>
            <textarea name="about" placeholder="About the event" class="form-control mb-2"></textarea>
            <label class="form-label fw-semibold" style="font-size:0.82rem;color:var(--br);">Start Date</label>
            <input type="date" name="startDate" class="form-control mb-2" required>
            <label class="form-label fw-semibold" style="font-size:0.82rem;color:var(--br);">End Date</label>
            <input type="date" name="endDate" class="form-control mb-2" required>
            <input type="file" name="bannerImage" class="form-control mb-3" accept="image/*" required>
            <button class="btn-register w-100">‚ûï Add Past Event</button>
          </form>
        </details>
      <% } %>

      <% if (pastEvents.length === 0) { %>
        <div class="gallery-empty" data-aos="fade-up">
          <div class="gallery-empty-icon">üï∞</div>
          <p>No past events yet.</p>
        </div>
      <% } %>

      <% pastEvents.forEach((event, i) => { %>
        <div class="event-card" data-aos="fade-up" data-aos-delay="<%= i * 70 %>">
          <% if (event.bannerImage) { %>
            <a href="/events/<%= event.id %>" class="event-card-img-wrap" style="display:block;text-decoration:none;">
              <img src="<%= event.bannerImage %>" class="event-card-img" alt="<%= event.title %>">
            </a>
          <% } %>
          <div class="event-card-body">
            <div class="d-flex align-items-start justify-content-between gap-2 mb-2">
              <a href="/events/<%= event.id %>" style="text-decoration:none;">
                <h3 class="event-card-title mb-0"><%= event.title %></h3>
              </a>
              <span class="badge-completed flex-shrink-0">Completed</span>
            </div>
            <% if (event.startDate && event.endDate) { %>
              <div class="event-card-date">
                <i class="bi bi-calendar3"></i>
                <%= new Date(event.startDate).toDateString() %>
                <% if (new Date(event.startDate).toDateString() !== new Date(event.endDate).toDateString()) { %>
                  ‚Üí <%= new Date(event.endDate).toDateString() %>
                <% } %>
              </div>
            <% } %>
            <div class="event-card-actions">
              <a href="/events/<%= event.id %>" class="btn-details">
                View Details <i class="bi bi-arrow-right"></i>
              </a>
            </div>
            <% if (user && (user.role === "admin" || user.role === "superadmin")) { %>
              <div class="mt-3">
                <form action="/events/delete/<%= event.id %>" method="POST" onsubmit="return confirm('Delete this event?')">
                  <button class="btn-admin-danger">‚úï Delete</button>
                </form>
              </div>
            <% } %>
          </div>
        </div>
      <% }) %>
    </div>

  </div>
</div>

<script>
(function(){
  const showUpcoming = document.getElementById('showUpcoming');
  const showPast = document.getElementById('showPast');
  const upcomingSection = document.getElementById('upcomingSection');
  const pastSection = document.getElementById('pastSection');

  if (showUpcoming && showPast && window.innerWidth < 992) {
    pastSection.style.display = 'none';
    showUpcoming.addEventListener('click', () => {
      upcomingSection.style.display = '';
      pastSection.style.display = 'none';
      showUpcoming.classList.add('active');
      showPast.classList.remove('active');
    });
    showPast.addEventListener('click', () => {
      pastSection.style.display = '';
      upcomingSection.style.display = 'none';
      showPast.classList.add('active');
      showUpcoming.classList.remove('active');
    });
  }
})();
</script>
